# Generated by Ollama Llama 3
# Task: reset_condition_change_minimal
# Attempt: 8
# Success: False
# Overall Score: 0.585

import pyverilog.vparser.ast as ast
from pyverilog.vparser.parser import parse
from pyverilog.vparser.astvisitor import Visitor
import re

class ResetTransformation(Visitor):
    def __init__(self, direction = 'high'):
        super().__init__()
        self.direction = direction
    
    def visit(self, node):
        if isinstance(node, ast.Initial): 
            return self.visit_initial(node)
        elif isinstance(node, ast.StatementList):
            return self.visit_statement_list(node)
    
    def visit_initial(self, node):
        if self.direction == 'high':
            for signal in node.signal:
                # Find reset condition
                if isinstance(signal, ast.Rst) and signal.value == 1:
                    print("Found active-high reset on signal: " + str(signal.name))
                    signal.value = 0
        else:
            for signal in node.signal:
                # Find reset condition
                if isinstance(signal, ast.Rst) and signal.value == 0:
                    print("Found active-low reset on signal: " + str(signal.name))
                    signal.value = 1
        
    def visit_statement_list(self, node):
        for statement in node.statements:
            self.visit(statement)
    
def transform(filename):
    with open(filename, 'r') as file: 
        code = file.read()
        ast_tree = parse(code)

    # Find reset statements
    transform = ResetTransformation('high')
    result = transform.visit(ast_tree)
    
    if not result:
        print("Error during transformation.")
        
    else:
        transformed_code = str(transform.ast) + "\n"
        with open(filename, 'w') as file: 
            file.write(transformed_code)

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('filename', help='the name of the Verilog file to transform')
    args = parser.parse_args()

    transform(args.filename)